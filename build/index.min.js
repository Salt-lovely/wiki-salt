"use strict";(()=>{var Pe=Object.defineProperty,Le=Object.defineProperties;var $e=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Wt=Object.prototype.hasOwnProperty,Ht=Object.prototype.propertyIsEnumerable;var Bt=(i,t,e)=>t in i?Pe(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Ot=(i,t)=>{for(var e in t||(t={}))Wt.call(t,e)&&Bt(i,e,t[e]);if(Z)for(var e of Z(t))Ht.call(t,e)&&Bt(i,e,t[e]);return i},Ut=(i,t)=>Le(i,$e(t));var Rt=(i,t)=>{var e={};for(var n in i)Wt.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&Z)for(var n of Z(i))t.indexOf(n)<0&&Ht.call(i,n)&&(e[n]=i[n]);return e};function N(i){let t=document.createElement("style");t.textContent=i,document.head.appendChild(t)}var zt="[wiki-salt]",I="wiki-salt-config-";function O(i,t){if(!i){let e=t||"发生错误";throw new Error(e)}}function Dt(i){document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i()}function B(i){return new Promise(t=>setTimeout(t,i||500))}function Ne(...i){return{log:(...a)=>console.log(...i,...a),error:(...a)=>console.error(...i,...a),warn:(...a)=>console.warn(...i,...a),debug:(...a)=>console.debug(...i,...a),info:(...a)=>console.info(...i,...a),clear:()=>console.clear()}}var h=Ne(zt);function wt(i,t){let{split:e=`
`,count:n=2,type:r=" ",skipBlank:s=!0}=t||{};return i.split(e).map(l=>s&&!l?l:r.repeat(n)+l).join(e)}var{log:j}=h,gt;async function jt(){j("正在初始化"),await Ie(),He()}function Ft(){return O(gt,"未检测到 mediaWiki Api"),gt}async function Ie(){await We(),gt=new mw.Api}async function Be(){let i=0;for(;!window.mw;)await B(500),O(i++<30,"未检测到 mediaWiki")}async function We(){await Be();let i=0;for(;!mw.Api;)await B(500),O(i++<30,"未检测到 mediaWiki Api")}function He(){let i=new mw.Api;typeof i.postWithEditToken!="function"&&(j("mw.Api原型没有postWithEditToken方法，自动加载..."),mw.Api.prototype.postWithEditToken=function(t,e){return this.postWithToken("csrf",t,e)}),typeof i.getEditToken!="function"&&(j("mw.Api原型没有getEditToken方法，自动加载..."),mw.Api.prototype.getEditToken=function(){return this.getToken("csrf")}),typeof i.create!="function"&&(j("mw.Api原型没有create方法，自动加载..."),mw.Api.prototype.create=function(t,e,n){return this.postWithEditToken($.extend(this.assertCurrentUser({action:"edit",title:String(t),text:n,formatversion:"2",createonly:!0}),e)).then(function(r){return r.edit})}),typeof i.edit!="function"&&(j("mw.Api原型没有edit方法，自动加载..."),mw.Api.prototype.edit=function(t,e){var n,r,s=this;return t=String(t),s.get({action:"query",prop:"revisions",rvprop:["content","timestamp"],titles:[t],formatversion:"2",curtimestamp:!0}).then(function(l){var a,o;return!l.query||!l.query.pages?$.Deferred().reject("unknown"):(a=l.query.pages[0],!a||a.invalid?$.Deferred().reject("invalidtitle"):a.missing?$.Deferred().reject("nocreate-missing"):(o=a.revisions[0],n=o.timestamp,r=l.curtimestamp,e({timestamp:o.timestamp,content:o.content})))}).then(function(l){var a=typeof l=="object"?l:{text:String(l)};return s.postWithEditToken($.extend({action:"edit",title:t,formatversion:"2",assert:mw.config.get("wgUserName")?"user":void 0,basetimestamp:n,starttimestamp:r,nocreate:!0},a))}).then(function(l){return l.edit})}),typeof i.newSection!="function"&&(j("mw.Api原型没有newSection方法，自动加载..."),mw.Api.prototype.newSection=function(t,e,n,r){return this.postWithEditToken($.extend({action:"edit",section:"new",title:String(t),summary:e,text:n},r))})}var _t=`
.user-select-none, .user-select-none * {
  user-select: none !important;
}

.wiki-salt-fade-in {
  animation: fade-in 300ms ease;
}

.wiki-salt-fade-out {
  animation: fade-out 300ms ease;
  opacity: 0;
}
.wiki-salt-fade-out, .wiki-salt-fade-out * {
  pointer-events: none;
}

@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
@keyframes fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}`;async function qt(){N(_t),await jt()}var b=i=>{var t;return(t=window.mw)==null?void 0:t.config.get(i)},ht=class{get isArticle(){return b("wgIsArticle")}get currentPageName(){return b("wgPageName").replace(/ /g,"_")}get currentSpecialPageName(){return b("wgCanonicalSpecialPageName")}get articleId(){return b("wgArticleId")}get revisionId(){return b("wgRevisionId")}get latestRevisionId(){return b("wgCurRevisionId")}get articlePath(){return b("wgArticlePath")}get scriptPath(){return b("wgScriptPath")}get action(){return b("wgAction")}get skin(){return b("skin")}get userName(){return b("wgUserName")}get userId(){return b("wgUserId")}get userGroups(){return b("wgUserGroups")}get pageContentModel(){return b("wgPageContentModel")}get wikiId(){return b("wgWikiID")}get apiUrl(){let{protocol:t,host:e}=location;return`${t}//${e}${b("wgScriptPath")}/api.php`}get wikiSaltHeader(){return{pragma:"no-cache","cache-control":"no-cache","Api-User-Agent":`wiki-salt/${b("wgWikiID")}`}}get wikiSaltHeaderCached(){return{"Api-User-Agent":`wiki-salt/${b("wgWikiID")}`}}},Oe=new ht,k=Oe;function W(i){return typeof i=="string"}function K(i){return typeof i=="number"}var tt=(()=>Number.isInteger||function(t){return K(t)&&isFinite(t)&&Math.floor(t)===t})();function et(i){return i===void 0}function Y(i){return i==null}function F(i){return typeof i=="function"}function U(i){return!!i&&typeof i=="object"}function yt(i){return tt(i)&&i>-1&&i<Number.MAX_SAFE_INTEGER}var it=(()=>Array.isArray)();function X(i){return U(i)&&yt(i.length)}var di=new Set(["__proto__","constructor","prototype","toString","hasOwnProperty","toLocaleString","valueOf","isPrototypeOf","propertyIsEnumerable"]);function te(i){return!di.has(i)}function kt(i){var t;let e=it(i)?i.slice():Object.create(((t=i.constructor)===null||t===void 0?void 0:t.prototype)||null);for(let r in i)te(r)&&(e[r]=i[r]);return Object.getOwnPropertySymbols(i).forEach(r=>e[r]=i[r]),e}function bt(i,t,e=!1){if(!F(t))return e?kt(i):i;let n=kt(i);for(let r in n)typeof n[r]!="undefined"&&t(r,n[r]);return e?n:i}function vt(i,t){for(let e=0;e<t.length;e++){let n=t[e];X(n)?vt(i,n):n instanceof Node?i.appendChild(n):(W(n)||K(n))&&i.appendChild(document.createTextNode(`${n}`))}}function ee(i,t){if(U(t))for(let e in t)e.startsWith("on")&&F(t[e])&&i.addEventListener(e.slice(2).toLowerCase(),t[e])}function ie(i,t){Object.assign(i,t)}function ne(i,t){if(t.style){let{style:e}=t;Object.assign(i.style,e)}if(t.dataSet){let{dataSet:e}=t;for(let n in e)Y(e[n])||i.setAttribute(`data-${n}`,`${e[n]}`)}}function m(i,t,...e){let n=document.createElement(i);if(t){let[r,s,l]=re(t);ie(n,r),ee(n,s),ne(n,l)}return vt(n,e),n}function re(i){let t={},e={},n={};return bt(i,(r,s)=>{et(s)||(r.startsWith("on")?t[r]=s:r==="style"||r==="dataSet"?n[r]=s:e[r]=s)}),[e,t,n]}function nt(i){if(i)try{return JSON.parse(i)}catch(t){}return null}function _(i,t){let e=localStorage.getItem(i);return e?nt(e):(S(i,t),t)}function S(i,t){localStorage.setItem(i,JSON.stringify(t))}function oe(i){let t=localStorage.getItem(i);return nt(t)}function pi(i,t={passive:!0}){return window.addEventListener("storage",i,t),()=>window.removeEventListener("storage",i,t)}function L(i){let{key:t,defaultValue:e,listener:n,callOnChange:r=!0,options:s={passive:!0}}=i,l=oe(t);e!==void 0&&l===null&&(S(t,e),l=e);let o=pi(c=>{if(c.key!==t||c.storageArea!==localStorage)return;let p=nt(c.newValue),f=nt(c.oldValue);if(r&&p===f)return;let u={key:t,newValue:p,oldValue:f,storageArea:c.storageArea,url:c.url};n(u)},s);return[l,o]}var ae=`
.wiki-salt-modal {
  display: relative;
  max-width: 100vw;
  max-height: 100vh;
  background-color: var(--bgcolor, var(--theme-background-color, #f9f9f9));
  border: 4px solid rgba(102, 102, 102, 0.4);
  border-radius: 8px;
  box-shadow: 2px 2px 8px rgba(102, 102, 102, 0.4);
  box-sizing: border-box;
  overflow: hidden;
  z-index: 99999998;
}
.wiki-salt-modal.wiki-salt-modal-fix {
  position: fixed;
}
.wiki-salt-modal.wiki-salt-modal-fix.wiki-salt-modal-fix-center {
  padding: 4px 8px;
  min-width: 20vw;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.wiki-salt-modal.wiki-salt-modal-abs {
  position: absolute;
}
.wiki-salt-modal .wiki-salt-modal-title-container {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  margin: 0 16px;
  border-bottom: 1px solid rgba(102, 102, 102, 0.4);
  cursor: all-scroll;
}
.wiki-salt-modal .wiki-salt-modal-title-container * {
  cursor: auto;
}
.wiki-salt-modal .wiki-salt-modal-title-container .wiki-salt-modal-title {
  height: 32px;
  line-height: 32px;
  font-size: 20px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.wiki-salt-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-buttons .wiki-salt-modal-title-btn {
  display: inline-block;
  min-width: 32px;
  height: 32px;
  min-height: 24px;
  line-height: 32px;
  padding: 0 8px;
  border-radius: 4px;
  font-size: 24px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  box-sizing: border-box;
  white-space: nowrap;
}
.wiki-salt-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-buttons .wiki-salt-modal-title-btn:hover {
  background-color: rgba(153, 153, 153, 0.2);
}
.wiki-salt-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-close-btn {
  display: inline-block;
  min-width: 32px;
  height: 32px;
  min-height: 24px;
  line-height: 32px;
  padding: 0 8px;
  border-radius: 4px;
  font-size: 24px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  box-sizing: border-box;
  padding: 0;
}
.wiki-salt-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-close-btn:hover {
  background-color: rgba(153, 153, 153, 0.2);
}
.wiki-salt-modal .wiki-salt-modal-content-container {
  margin: 8px;
  overflow-x: hidden;
  overflow-y: auto;
}
.wiki-salt-modal .wiki-salt-modal-footer-container {
  display: flex;
  flex-direction: row-reverse;
  align-items: center;
  margin: 8px;
  min-height: 24px;
  font-size: var(--font-size, 16px);
}
.wiki-salt-modal .wiki-salt-modal-footer-container .wiki-salt-modal-footer-btn {
  display: inline-block;
  min-width: 32px;
  height: 24px;
  min-height: var(--font-size, 16px);
  line-height: 24px;
  padding: 0 8px;
  border-radius: 4px;
  font-size: var(--font-size, 16px);
  text-align: center;
  cursor: pointer;
  user-select: none;
  box-sizing: border-box;
}
.wiki-salt-modal .wiki-salt-modal-footer-container .wiki-salt-modal-footer-btn:hover {
  background-color: rgba(153, 153, 153, 0.2);
}
.wiki-salt-modal .wiki-salt-modal-drag-bar {
  position: absolute;
  display: block;
  opacity: 0;
  z-index: 999;
}
.wiki-salt-modal .wiki-salt-modal-drag-bar-left {
  left: 0;
  top: 8px;
  bottom: 8px;
  width: 8px;
  cursor: w-resize;
}
.wiki-salt-modal .wiki-salt-modal-drag-bar-right {
  right: 0;
  top: 8px;
  bottom: 8px;
  width: 8px;
  cursor: e-resize;
}
.wiki-salt-modal .wiki-salt-modal-drag-bar-top {
  top: 0;
  left: 8px;
  right: 8px;
  height: 8px;
  cursor: n-resize;
}
.wiki-salt-modal .wiki-salt-modal-drag-bar-bottom {
  bottom: 0;
  left: 8px;
  right: 8px;
  height: 8px;
  cursor: s-resize;
}`;function Et(i){let t={x:0,y:0,top:0,left:0,w:0,h:0},e="drag",{container:n,callback:r}=i,{dragBar:s,leftBar:l,rightBar:a,topBar:o,bottomBar:c}=i,p=g=>{let{currentTarget:y}=g;if(y!==window)return;let C={drag:fi,left:ui,right:wi,top:gi,bottom:hi},d={container:n,origin:t,ev:g};C[e](d)},f=g=>{let{x:y,y:C,target:d,currentTarget:x}=g;if(x!==window)return;let{offsetTop:E,offsetLeft:A,offsetWidth:R,offsetHeight:z}=n;t={x:y,y:C,top:E,left:A,w:R,h:z},d instanceof HTMLElement&&[s,l,a,o,c].includes(d)&&(window.addEventListener("mousemove",p),n.classList.add("user-select-none"),d===s?e="drag":d===l?e="left":d===a?e="right":d===o?e="top":d===c&&(e="bottom"))},u=g=>{let{currentTarget:y}=g;if(y===window&&(n.classList.remove("user-select-none"),window.removeEventListener("mousemove",p),r)){let{offsetTop:C,offsetLeft:d,offsetWidth:x,offsetHeight:E}=n;r({top:C,left:d,width:x,height:E})}};return window.addEventListener("mousedown",f),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",u),window.removeEventListener("mousemove",p)}}function fi(i){let{ev:t,container:e,origin:n}=i,{x:r,y:s}=t,{x:l,y:a,top:o,left:c,w:p,h:f}=n,u=o+s-a,g=c+r-l;u<0?u=0:u+f>window.innerHeight&&(u=window.innerHeight-f),g<0?g=0:g+p>window.innerWidth&&(g=window.innerWidth-p),e.style.top=`${u}px`,e.style.left=`${g}px`}function ui(i){let{ev:t,container:e,origin:n}=i,{x:r}=t,{x:s,left:l,w:a}=n,o=l+r-s;o<0?o=0:o>a+l-window.innerWidth*.2&&(o=a+l-window.innerWidth*.2);let c=a-o+l;e.style.width=`${c}px`,e.style.left=`${o}px`}function wi(i){let{ev:t,container:e,origin:n}=i,{x:r}=t,{x:s,w:l}=n,a=l+r-s;a<window.innerWidth*.2&&(a=window.innerWidth*.2),e.style.width=`${a}px`}function gi(i){let{ev:t,container:e,origin:n}=i,{y:r}=t,{y:s,top:l,h:a}=n,o=l+r-s;o<0?o=0:o>a+l-window.innerHeight*.3&&(o=a+l-window.innerHeight*.3);let c=a-o+l;e.style.height=`${c}px`,e.style.top=`${o}px`}function hi(i){let{ev:t,container:e,origin:n}=i,{y:r}=t,{y:s,h:l}=n,a=l+r-s;a<window.innerHeight*.3&&(a=window.innerHeight*.3),e.style.height=`${a}px`}N(ae);function se(i){let{isFixed:t=!0,className:e="",id:n,titleClassName:r="",titleContainerClassName:s="",closeButton:l=!0,buttons:a=[],onClose:o,onBeforeClose:c,height:p=window.innerHeight*.8,width:f=window.innerWidth*.8,top:u=window.innerHeight*.1,left:g=window.innerWidth*.1,resizeCallback:y}=i,C=async()=>{if(!(c&&await c()===!1)){if(o){let pt=await o()}mt(),T.classList.add("wiki-salt-fade-out"),setTimeout(()=>T.remove(),300)}},d=l?m("div",{className:"wiki-salt-modal-title-btn wiki-salt-modal-title-close-btn",onclick:()=>C()},"×"):null,x=m("div",{className:"wiki-salt-modal-title "+r}),E=m("div",{className:"wiki-salt-modal-title-buttons"},a,d),A=m("div",{className:"wiki-salt-modal-title-container "+s},x,E),R=m("div",{className:"wiki-salt-modal-content-container"}),z=m("div",{className:"wiki-salt-modal-drag-bar wiki-salt-modal-drag-bar-left",title:"调整宽度"}),G=m("div",{className:"wiki-salt-modal-drag-bar wiki-salt-modal-drag-bar-right",title:"调整宽度"}),ct=m("div",{className:"wiki-salt-modal-drag-bar wiki-salt-modal-drag-bar-top",title:"调整高度"}),dt=m("div",{className:"wiki-salt-modal-drag-bar wiki-salt-modal-drag-bar-bottom",title:"调整高度"}),T=m("div",{className:`wiki-salt-modal wiki-salt-fade-in ${t?"wiki-salt-modal-fix":"wiki-salt-modal-abs"} ${e}`},A,R,z,G,ct,dt);n&&(T.id=n),T.style.height=typeof p=="number"?`${p.toFixed(2)}px`:p,T.style.width=typeof f=="number"?`${f.toFixed(2)}px`:f,T.style.top=typeof u=="number"?`${u.toFixed(2)}px`:u,T.style.left=typeof g=="number"?`${g.toFixed(2)}px`:g,document.body.appendChild(T);let mt=Et({container:T,dragBar:A,leftBar:z,rightBar:G,topBar:ct,bottomBar:dt,callback:y});return{modalContainer:T,modalTitleContainer:A,modalTitleButtons:E,modalTitle:x,modalContentContainer:R,closeModal:C}}var xi="wiki-salt-modal-content-container wiki-salt-modal-content-container-with-footer",yi="wiki-salt-modal wiki-salt-fade-in wiki-salt-modal-fix wiki-salt-modal-fix-center";async function M(i){let t={};t.promise=new Promise((p,f)=>{t.res=p,t.rej=f});let e=typeof i=="string"||i instanceof Element?i:i.content,n=m("div",{className:xi},e),s=(typeof i=="string"||i instanceof Element?null:i.content)?m("div",{className:"wiki-salt-modal-title-container"}):null,l=m("div",{className:"wiki-salt-modal-footer-container"},m("div",{className:"wiki-salt-modal-footer-btn-group"},m("div",{className:"wiki-salt-modal-footer-btn",onclick:()=>{o(),t.res(!1)}},"取消"),m("div",{className:"wiki-salt-modal-footer-btn btn-primary",onclick:()=>{o(),t.res(!0)}},"确定"))),a=m("div",{className:yi},s,n,l),o=()=>{c(),a.classList.add("wiki-salt-fade-out"),setTimeout(()=>a.remove(),300)},c=Et({container:a,dragBar:a});return document.body.appendChild(a),t.promise}var le=`
#wiki-salt-notice {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 99999999;
}
#wiki-salt-notice .wiki-salt-notice-container {
  display: flex;
  position: absolute;
  top: 16px;
  left: 32px;
  right: 32px;
  bottom: 16px;
  pointer-events: none;
}
#wiki-salt-notice .wiki-salt-notice-container .wiki-salt-notice {
  min-width: 320px;
  min-height: 84px;
  padding: 16px 32px;
  margin-block-end: 16px;
  border-radius: 8px;
  box-sizing: border-box;
  background-color: var(--lightcolor, var(--theme-card-background-color, #fff));
  box-shadow: 1px 2px 5px 1px rgba(153, 153, 153, 0.6);
  pointer-events: auto;
  animation: fade-in 300ms ease;
}
#wiki-salt-notice .wiki-salt-notice-container .wiki-salt-notice .wiki-salt-notice-title {
  font-size: var(--font-size-small, 14px);
  margin-block-end: 12px;
}
#wiki-salt-notice .wiki-salt-notice-container .wiki-salt-notice .wiki-salt-notice-content {
  font-size: var(--font-size, 16px);
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-t {
  flex-direction: column;
  align-items: center;
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-tr {
  flex-direction: column;
  align-items: flex-end;
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-r {
  flex-direction: column-reverse;
  align-items: flex-end;
  justify-content: center;
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-br {
  flex-direction: column-reverse;
  align-items: flex-end;
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-b {
  flex-direction: column-reverse;
  align-items: center;
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-bl {
  flex-direction: column-reverse;
  align-items: flex-start;
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-l {
  flex-direction: column-reverse;
  align-items: flex-start;
  justify-content: center;
}
#wiki-salt-notice .wiki-salt-notice-container.wiki-salt-notice-container-tl {
  flex-direction: column;
  align-items: flex-start;
}`;N(le);var ki=["t","tr","r","br","b","bl","l","tl"],ce=Array(8).fill(0).map((i,t)=>m("div",{className:`wiki-salt-notice-container wiki-salt-notice-container-${ki[t]}`})),bi=m("div",{className:"wiki-salt-notice",id:"wiki-salt-notice"},ce);document.body.appendChild(bi);function de(i){var c;let{className:t,title:e,content:n,time:r=5e3,fadeTime:s=2e3,closeable:l=!1,pos:a=1}=i,o=m("div",{className:`wiki-salt-notice wiki-salt-fade-in ${t}`},e?m("div",{className:"wiki-salt-notice-title"},e):null,n?m("div",{className:"wiki-salt-notice-content"},n):null);setTimeout(()=>{o.classList.add("fade-out"),setTimeout(()=>{o.remove()},s)},r),(c=ce[a])==null||c.appendChild(o)}function q(i,t,e=5e3){de({className:"wiki-salt-notice-info",title:t,content:i,time:e})}function J(i,t,e=5e3){console.log(i),de({className:"wiki-salt-notice-alarm",title:t,content:i,time:e})}var vi={get:async(i,t)=>{let e=new URL(k.apiUrl);for(let[r,s]of Object.entries(i))s!==void 0&&e.searchParams.append(r,`${s}`);let n=await fetch(e,{method:"GET",credentials:"same-origin",headers:k.wikiSaltHeader});return!t||t==="json"?n.json():t==="text"?n.text():n},post:async(i,t)=>{let e=new URL(k.apiUrl),n=new FormData;for(let[s,l]of Object.entries(i))l!==void 0&&n.append(s,l);let r=await fetch(e,{method:"POST",body:n,credentials:"same-origin",headers:k.wikiSaltHeader});return!t||t==="json"?r.json():t==="text"?r.text():r}},me=i=>`<div>${i}解析失败</div>`;async function pe(i){let{wikitext:t,title:e}=i,n=e!=null?e:k.currentPageName;try{let r=await vi.post({format:"json",action:"parse",text:t,title:n,pst:"true"});return r.parse&&r.parse.text?r.parse.text["*"]||"":me(n)}catch(r){return h.error(`${n}页面解析失败`,r),J(`${r}`,`${n}页面解析失败`),me(n)}}async function Ct(i){let{title:t,section:e}=i;try{let n=await await fetch(`//${location.host}${k.scriptPath}/index.php?title=${t}${e?`&section=${e}`:""}&action=raw`,{method:"GET",headers:k.wikiSaltHeader});if(!n||Number(n.status)>299)throw new Error("失败代码"+n.status);return n.text()}catch(n){return h.error("获取源代码信息失败",n),J(`${n}`,`${t}源代码获取失败`),!1}}async function rt(i){let{title:t,section:e,wikitext:n,originWikitext:r}=i,s=Ft(),l=await Ct({title:t,section:e});if(r&&l!==r&&!await M("发现编辑冲突，您编辑的版本与页面的当前版本不同，执意提交可能覆盖别人的编辑，您确定要继续吗？")||l===n&&!await M("您提交的版本与页面的当前版本一致，您确定要继续吗？"))return!1;let{sectionTitle:a,summary:o,minor:c=!1}=i,p=await s.postWithEditToken({action:"edit",formatversion:"2",assert:k.userName?"user":void 0,nocreate:!0,title:t,section:e,text:n,minor:c,summary:o||Tt({title:t,section:e,sectionTitle:a})});return console.log(p),p}function Tt(i){let{title:t,section:e,sectionTitle:n,isEditing:r=!0}=i,s="// WikiSalt Editor";return t?!e||!n?`${r?"编辑":"创建"}“${t}” ${s}`:`${r?"编辑":"创建"}“${t}”的“${n}”章节 ${s}`:s}var St={"moderation-edit-queued":"等待版主审核"};function fe(i){return W(i)?St[i]||i:i instanceof Error&&(St[i.name]||St[i.message]||i.message||i.name)||"未知错误，更多信息请见检查控制台"}var{log:Ei}=h,ot=`${I}EditDefaultMinor`,at=`${I}EditLivePreview`;function ue(i,t){let[e]=L({key:ot,defaultValue:!1,listener({newValue:f}){e=f||!1,n.textContent=f?"✔️默认小编辑":"❌默认小编辑"}}),n=m("div",{className:"wiki-salt-modal-title-btn",onclick(){e=!e,S(ot,e),n.textContent=e?"✔️默认小编辑":"❌默认小编辑"}},e?"✔️默认小编辑":"❌默认小编辑");L({key:at,defaultValue:!1,listener({newValue:f}){i.isLivePreview=f||!1,r.textContent=f?"✔️实时预览":"❌实时预览"}});let r=m("div",{className:"wiki-salt-modal-title-btn",onclick(){i.isLivePreview=!i.isLivePreview,S(at,i.isLivePreview),r.textContent=i.isLivePreview?"✔️实时预览":"❌实时预览"}},i.isLivePreview?"✔️实时预览":"❌实时预览");t.prependBtn(n),t.prependBtn(r);let s=m("div",{className:"wiki-salt-edit-modal-preview-content mw-body-content"},"正在加载..."),l=m("div",{className:"wiki-salt-edit-modal-btn wiki-salt-edit-modal-preview-btn",onclick:async()=>{if(i.isSubmit||i.isLoading)return!1;await t.parseTxt(i.editTxt,!0)!==!1||q("获取预览失败")}},"预览"),a=m("div",{className:"wiki-salt-edit-modal-btn wiki-salt-edit-modal-preview-btn",onclick:async()=>{if(i.isSubmit||i.isLoading)return!1;if(i.isSubmit=!0,!await M("您确定要提交编辑吗？"))return i.isSubmit=!1,!1;a.textContent="正在提交...";let f=Date.now();try{await rt({title:i.title,section:i.section,sectionTitle:i.sectionTitle,summary:i.summary,minor:i.isMinor,wikitext:i.editTxt,originWikitext:i.originTxt})!==!1?(i.isSubmitSuccess=!0,q(`编辑提交成功，耗时${Date.now()-f}ms，将刷新页面`),setTimeout(()=>{t.closeModal(),location.reload()},2500)):(i.isSubmit=!1,q("编辑提交失败"),a.textContent="再次提交")}catch(u){Ei(`编辑提交失败
`,u),i.isSubmit=!1,J(`${fe(u)}`,"编辑提交失败"),a.textContent="再次提交"}}},"提交"),o=m("div",{className:"wiki-salt-edit-modal-btn wiki-salt-edit-modal-minor-btn not-minor",onclick:async()=>{i.isMinor=!i.isMinor,o.textContent=i.isMinor?"✔️小编辑":"❌小编辑",o.classList.add(i.isMinor?"is-minor":"not-minor"),o.classList.remove(i.isMinor?"not-minor":"is-minor")}},i.isMinor?"✔️小编辑":"❌小编辑"),c=m("input",{className:"wiki-salt-edit-modal-summary-input",value:i.summary,oninput:()=>{i.summary=c.value},onchange:()=>{i.summary=c.value}}),p=m("div",{className:"wiki-salt-edit-modal-preview-panel"},m("div",{className:"wiki-salt-edit-modal-preview-btn-group"},l,a,o,c),s);return{previewContent:s,previewBtn:l,submitBtn:a,minorBtn:o,summaryInput:c,previewPanel:p}}var we=`${I}EditTextareaType`,At=`${I}EditTextareaWidth`;function ge(i,t,e){let[n]=L({key:we,defaultValue:e.offsetWidth>960?"horizon":"vertical",listener({newValue:c}){n=c||"horizon",o()}}),[r]=L({key:At,defaultValue:50,listener({newValue:c}){r=Number(c)||50,n==="horizon"&&o()}}),s=m("div",{className:"wiki-salt-modal-title-btn",title:"切换编辑框视图为左右/上下结构",onClick:()=>{n=n==="horizon"?"vertical":"horizon",s.textContent=n==="horizon"?"⿰横排":"⿱竖排",S(we,n),o()}},n==="horizon"?"⿰横排":"⿱竖排");t.prependBtn(s);let l=m("div",{className:"wiki-salt-edit-modal-horizon-bar",title:"左右拖动可以调整宽度，双击恢复宽度"},m("div",{className:"wiki-salt-edit-modal-bar-icon"},"|||")),a=m("div",{className:"wiki-salt-edit-modal-vertical-bar"},m("div",{className:"wiki-salt-edit-modal-bar-icon"},"---")),o=()=>{n==="horizon"?(e.classList.remove("vertical"),e.classList.add("horizon"),e.style.setProperty("--textareaWidth",`${r}%`),e.style.setProperty("--previewWidth",`${100-r}%`),l.title=`左右拖动可以调整宽度，双击恢复宽度；
当前宽度 ${r.toFixed(2)}% : ${(100-r).toFixed(2)}%`):(e.classList.add("vertical"),e.classList.remove("horizon"))};return o(),Ci({horizonBar:l,container:e,callback(c,p=!1){r=c,p&&(S(At,c),t.updateCMEditor()),o()}}),{horizonBar:l,verticalBar:a}}function Ci({horizonBar:i,container:t,callback:e}){let n={x:0,w:0,active:!1};i.addEventListener("dblclick",r=>{e(50,!0),r.preventDefault()}),i.addEventListener("mousedown",r=>{r.button===0&&(n.active=!0,n.x=r.x,n.w=Number(_(At,50))||50,r.preventDefault())}),t.addEventListener("mousemove",r=>{if(n.active){let s=n.x-r.x,l=Number((s/t.offsetWidth*100).toFixed(4)),a=Math.min(Math.max(n.w-l,25),75);e(a),r.preventDefault()}}),t.addEventListener("mouseup",r=>{if(n.active){n.active=!1;let s=n.x-r.x,l=Number((s/t.offsetWidth*100).toFixed(4)),a=Math.min(Math.max(n.w-l,25),75);e(a,!0),r.preventDefault()}})}var{log:Ti}=h,he=`${I}EditEnableCodeMirror`,ke="ext.CodeMirror",Si="ext.CodeMirror.lib",Ai="ext.CodeMirror.addons",Mi="ext.CodeMirror.mode.mediawiki",Pi="ext.CodeMirror.lib.mode.javascript",Li="ext.CodeMirror.lib.mode.css",xe={wikitext:Mi,javascript:Pi,css:Li};function Mt(){var t;let i=(t=window.mw)==null?void 0:t.loader.getState(ke);return!!W(i)}function $i(i,t="加载超时",e=1e4){return Promise.race([i,new Promise((n,r)=>setTimeout(()=>r({message:t}),e))])}async function st(i,t=2e4){window.mw.loader.getState(i)!=="ready"&&(Ti("加载Wiki安装的CodeMirror拓展",i),await $i(window.mw.loader.using(i),`加载${i}超时`))}async function Pt(i){var e;if(!((e=window.mw)!=null&&e.loader.using))return!1;await st(Si),await st(Ai),await st(ke);let t=xe[k.pageContentModel]||xe.wikitext;return await st(t),!0}function be(i,t){let[e]=L({key:he,defaultValue:!1,listener({newValue:r}){e=r||!1,n.className=`wiki-salt-modal-title-btn cm-${e?"enable":"disable"}`,e?t.showCMEditor():t.showTextAreaEditor()}}),n=m("div",{className:`wiki-salt-modal-title-btn cm-${e?"enable":"disable"}`,title:"使用代码高亮编辑框，需要当前Wiki安装CodeMirror编辑器拓展方可起效",onClick:()=>{e=!e,S(he,e),n.className=`wiki-salt-modal-title-btn cm-${e?"enable":"disable"}`,e?t.showCMEditor():t.showTextAreaEditor()}},m("span",{className:"cm-btn-txt left-angle"},"<"),m("span",{className:"cm-btn-txt center-slash"},"/"),m("span",{className:"cm-btn-txt right-angle"},">"));return t.prependBtn(n),{enableCM:e,enableCMButton:n,getEnableCM:()=>e}}var ye={wikitext:{mode:"text/mediawiki",inputStyle:"contenteditable",lineWrapping:!0},javascript:{mode:"javascript",inputStyle:"contenteditable",lineWrapping:!1},css:{mode:"css",inputStyle:"contenteditable",lineWrapping:!1}};function ve(i,t,e){return window.CodeMirror?window.CodeMirror(i,Ut(Ot({},ye[k.pageContentModel]||ye.wikitext),{value:t.editTxt,addModeClass:!1,allowDropFileTypes:null,autocapitalize:!1,autocorrect:!1,autofocus:!1,autoRefresh:!0,coverGutterNextToScrollbar:!1,cursorBlinkRate:530,cursorHeight:1,cursorScrollMargin:0,dragDrop:!0,electricChars:!0,extraKeys:{End:"goLineRight",Home:"goLineLeft","Shift-Tab":!1,Tab:!1},firstLineNumber:1,fixedGutter:!0,flattenSpans:!0,historyEventDelay:1250,indentUnit:2,indentWithTabs:!1,keyMap:"default",lineNumbers:!0,lineWiseCopyCut:!0,matchBrackets:{highlightNonMatching:!1,maxHighlightLineLength:1e4},maxHighlightLength:1e4,moveInputWithCursor:!0,pasteLinesPerSelection:!0,pollInterval:100,readOnly:!1,resetSelectionOnContextMenu:!0,rtlMoveVisually:!1,screenReaderLabel:"维基盐编辑器的CodeMirror编辑框",scrollbarStyle:"native",selectionsMayTouch:!1,showCursorWhenSelecting:!1,singleCursorHeightPerLine:!0,smartIndent:!0,spellcheck:!0,tabSize:4,tabindex:1,theme:"default",undoDepth:200,viewportMargin:1/0,wholeLineUpdateBefore:!0,workDelay:100,workTime:100,mwConfig:window.mw.config.values.extCodeMirrorConfig})):!1}var{log:Ni}=h;async function Lt(i){let{title:t,section:e,sectionTitle:n}=i,{modalContainer:r,modalTitleContainer:s,modalTitleButtons:l,modalTitle:a,modalContentContainer:o,closeModal:c}=se({className:"wiki-salt-edit-modal",titleContainerClassName:"wiki-salt-edit-modal-title",resizeCallback:({width:v,height:H})=>{Object.assign(d,{width:o.offsetWidth,height:o.offsetHeight})},onBeforeClose:async()=>{if(!d.isLoading&&!d.isSubmitSuccess){if(d.originTxt!==!1&&d.editTxt!==d.originTxt)return await M("您有未保存的更改，确定要关闭编辑框吗？");if(d.isSubmit)return await M("正在提交编辑，确定要关闭编辑框吗？")}},onClose:()=>{window.onclose=window.onbeforeunload=null}});window.onclose=window.onbeforeunload=()=>{if(!d.isLoading&&!d.isSubmitSuccess){if(d.originTxt!==!1&&d.editTxt!==d.originTxt)return"您有未保存的更改，确定要关闭编辑框吗？";if(d.isSubmit)return"正在提交编辑，确定要关闭编辑框吗？"}};let p=0,f=0,u=0,g="",y=1e3,C=1e4,d={width:o.offsetWidth,height:o.offsetHeight,currentEditor:"TextArea",editTxt:"正在加载...",summary:Tt({title:t,section:e,sectionTitle:n}),isLoading:!0,isParsing:!1,isSubmit:!1,isSubmitSuccess:!1,isMinor:_(ot,!1),isLivePreview:_(at,!1),title:t,section:e,sectionTitle:n,originTxt:!1,editor:null},x={parseTxt:async(v,H)=>{if(d.isSubmit)return!1;let P=Date.now();if(d.isParsing)return clearTimeout(u),u=setTimeout(()=>x.parseTxt(v),y),f=P,!1;if(!H&&P-f<y&&P-p<C){let ut=Math.min(C-P+p,y);return clearTimeout(u),u=setTimeout(()=>x.parseTxt(v),ut),f=Date.now(),!1}if(d.isParsing=!0,G.textContent="预览...",g!==v||H){let ut=await pe({wikitext:v,title:t});z.innerHTML=ut,g=v}d.isParsing=!1,G.textContent="预览",p=Date.now(),f=Date.now()},closeModal:c,prependBtn:v=>{l.prepend(v)},loadCMEditor:async v=>{if(Mt()){let H=!1;if(v?H=await v:H=await Pt(t),!H||d.editor)return!1;let P=ve(A,d,x);if(P)return d.editor=P,P.on("change",()=>{d.editTxt=P.getValue(),d.isLivePreview&&x.parseTxt(d.editTxt,!1)}),!0}return!1},showCMEditor:()=>{d.editor&&D()?(d.currentEditor="CodeMirror",E.style.display="none",A.style.display="block",x.updateCMEditor()):x.loadCMEditor().then(v=>{v&&D()&&x.showCMEditor()})},updateCMEditor:()=>{d.editor&&d.currentEditor==="CodeMirror"&&(d.editor.setValue(d.editTxt),d.editor.focus(),d.editor.refresh())},showTextAreaEditor:()=>{D()||(d.currentEditor="TextArea",A.style.display="none",E.style.display="block")}},E=m("textarea",{className:"wiki-salt-edit-modal-edit-textarea",value:d.editTxt,oninput:()=>{d.editTxt=E.value,d.isLivePreview&&x.parseTxt(d.editTxt,!1)},onchange:()=>{d.editTxt=E.value},disabled:!0}),A=m("div",{className:"wiki-salt-edit-modal-edit-textarea wiki-salt-edit-modal-edit-CM",style:{display:"none"}}),R=m("div",{className:"wiki-salt-edit-modal-edit-panel"},E,A),{previewContent:z,previewBtn:G,submitBtn:ct,minorBtn:dt,summaryInput:T,previewPanel:mt}=ue(d,x),{horizonBar:pt,verticalBar:Ui}=ge(d,x,o);a.textContent=`编辑“${t}”页面${n?`的“${n}”章节`:""}`,o.appendChild(R),o.appendChild(pt),o.appendChild(mt);let ft=Mt(),{getEnableCM:D,enableCMButton:Ri}=be(d,x),It=Promise.resolve(!1);if(Ni("当前Wiki是否存在CodeMirror功能:",ft,"; 使用CodeMirror编辑框:",D()),ft&&D()&&(It=Pt(t)),d.originTxt=await Ct({title:t,section:e}),d.originTxt===!1){q("获取页面失败"),c();return}E.value=d.originTxt,d.editTxt=d.originTxt,d.isLoading=!1,E.disabled=!1,x.parseTxt(d.originTxt),ft&&D()&&x.loadCMEditor(It).then(v=>{v&&x.showCMEditor()})}var Ee=`
.wiki-salt-edit-modal {
  background-clip: padding-box;
  border: 8px solid rgba(102, 102, 102, 0.4);
}
.wiki-salt-edit-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-buttons .wiki-salt-modal-title-btn {
  font-size: 16px;
}
.wiki-salt-edit-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-buttons .wiki-salt-modal-title-btn.cm-enable {
  color: #36c;
}
.wiki-salt-edit-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-buttons .wiki-salt-modal-title-btn.cm-enable .center-slash {
  color: #c36;
}
.wiki-salt-edit-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-buttons .wiki-salt-modal-title-btn.cm-disable {
  color: #36c;
}
.wiki-salt-edit-modal .wiki-salt-modal-title-container .wiki-salt-modal-title-buttons .wiki-salt-modal-title-btn.cm-disable .cm-btn-txt {
  color: #222;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container {
  position: relative;
  display: flex;
  height: calc(100% - 49px - 16px);
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container.vertical {
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container.vertical .wiki-salt-edit-modal-horizon-bar {
  display: none;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container.horizon {
  flex-direction: row;
  justify-content: space-between;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container.horizon .wiki-salt-edit-modal-edit-panel {
  position: sticky;
  top: 0;
  height: 100%;
  width: var(--textareaWidth, 50%);
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container.horizon .wiki-salt-edit-modal-edit-panel .wiki-salt-edit-modal-edit-textarea {
  height: 100% !important;
  resize: none;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container.horizon .wiki-salt-edit-modal-preview-panel {
  width: var(--previewWidth, 50%);
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container.horizon .wiki-salt-edit-modal-vertical-bar {
  display: none;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-edit-panel .wiki-salt-edit-modal-edit-textarea {
  width: 100%;
  min-height: 240px;
  resize: vertical;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-edit-panel .wiki-salt-edit-modal-edit-CM > .CodeMirror {
  height: 100%;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-edit-panel .wiki-salt-edit-modal-edit-CM > .CodeMirror pre.CodeMirror-line {
  background-color: transparent !important;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-preview-panel {
  position: relative;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-preview-panel .wiki-salt-edit-modal-preview-btn-group {
  width: 100%;
  margin: 8px 0 0;
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  flex-direction: row;
  justify-content: flex-start;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-preview-panel .wiki-salt-edit-modal-preview-btn-group .wiki-salt-edit-modal-btn {
  flex-shrink: 0;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-preview-panel .wiki-salt-edit-modal-preview-btn-group .wiki-salt-edit-modal-summary-input {
  width: 100%;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-preview-panel .wiki-salt-edit-modal-preview-content {
  margin: 16px 8px 8px;
  height: calc(100% - 40px - 16px);
  overflow: auto;
  box-shadow: 0 0 0 8px rgba(17, 17, 17, 0.0666666667);
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-preview-panel .wiki-salt-edit-modal-preview-content > .mw-parser-output {
  overflow: hidden;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-vertical-bar {
  height: 8px;
  width: 100%;
  cursor: n-resize;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-horizon-bar {
  width: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: w-resize;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-horizon-bar .wiki-salt-edit-modal-bar-icon {
  font-size: 8px;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-btn {
  display: inline-block;
  min-width: 48px;
  height: 24px;
  min-height: 16px;
  line-height: 24px;
  padding: 0 8px;
  border-radius: 4px;
  font-size: 16px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  box-sizing: border-box;
}
.wiki-salt-edit-modal .wiki-salt-modal-content-container .wiki-salt-edit-modal-btn:hover {
  background-color: rgba(153, 153, 153, 0.2);
}`;N(Ee);function $t(i){let t={title:(i==null?void 0:i.title)||k.currentPageName,section:i==null?void 0:i.section,sectionTitle:i==null?void 0:i.sectionTitle};Lt(t)}var Ii="#ca-edit",Bi='.mw-editsection > a[href*="&action=edit"]';function lt(i){let t=document.body.querySelector(Ii),e=m("li",{className:"mw-list-item collapsible wiki-salt-top-edit-btn",id:"wiki-salt-top-edit-btn"},m("a",{href:"",onclick:r=>{r.preventDefault(),$t()}},"盐编辑"));i==="vector-2022"&&e.classList.add("vector-tab-noicon"),t&&(t.nextSibling?t.parentElement.insertBefore(e,t.nextSibling):t.parentElement.appendChild(e)),Array.from(document.body.querySelectorAll(Bi)).forEach(r=>{var f,u,g;let s=decodeURIComponent(r.href),l=(s.match(/title=([^&]+)/)||[])[1],a=(u=(f=s.match(/section=([^&]+)/))==null?void 0:f[1])==null?void 0:u.replace(/T-/gi,""),o=((g=r.parentElement.parentElement.querySelector(".mw-headline"))==null?void 0:g.textContent)||"",c=m("a",{title:o,onclick:y=>{y.preventDefault(),$t({title:l,section:a,sectionTitle:o})}},"盐编辑"),p=m("span",{className:"mw-editsection-divider"}," | ");if(p.style.display="inline",r.nextSibling){let y=r.nextSibling;r.parentElement.insertBefore(p,y),r.parentElement.insertBefore(c,y)}else r.parentElement.appendChild(p),r.parentElement.appendChild(c)})}var Ce={vector:lt,"vector-2022":lt};function Te(){if(k.action!=="view")return;let i=k.skin;(Ce[i]||Ce.vector)(i),h.log("添加编辑按钮子模块初始化完成")}function Se(){let{currentSpecialPageName:i}=k;if(i!=="DoubleRedirects")return;let t=document.querySelector(".mw-spcontent");if(!t)return;let e=Array.from(t.querySelectorAll("ul.special li,ol.special li"));!(e!=null&&e.length)||(e.forEach(n=>{var o,c;let r=(o=n.querySelector('a[title]:not(.mw-redirect):not([href*="edit"])'))==null?void 0:o.title,s=(c=n.querySelector('a[title].mw-redirect:not([href*="edit"])'))==null?void 0:c.title,l=n.querySelector('a[href*="action=edit"]');if(!r||!s||!l)return;let a=m("a",{className:"mw-redirect",title:`将“${s}”重定向到“${r}”`},"（更改重定向）");a.addEventListener("click",async()=>{if(!await M(m("span",null,"将“",m("code",null,s),"”重定向到“",m("code",null,r),"”，请确认？")))return!1;a.textContent="（正在重定向...）",await rt({title:s,wikitext:`#重定向 [[${r}]]`,minor:!0,summary:`将“${s}”重定向到“${r}”，维基盐双重重定向快速修复`}),a.textContent="（请刷新页面检查效果）"}),l.parentElement.insertBefore(a,l)}),h.log("双重重定向快速处理子模块初始化完成"))}var{log:w}=h,Q=class{constructor(t,e){this.titleList="";this.help=this.usage;this.ver=t||"",this.note=e||{basic:"",short:"SaltWikiEditHelper",methods:[]},this.getMwApi(),this.addPlugin()}version(){w(`
 Version: ${this.ver}
 Author: Salt_lovely
 License: MulanPSL-2.0`)}usage(t){let e=o=>o.map(({name:c,type:p,desc:f,require:u})=>`${c}${u?"*必填*":""}: ${p||""} ${f}`).join(`
`)+`
`,n=o=>`${s}.${o.name}(${o.params.map(({name:c})=>c).join(", ")})
`+wt((o.desc?o.desc+`
`:"")+e(o.params)),{basic:r,short:s,methods:l}=this.note,a=l.find(({name:o})=>o===t);return a?w(n(a)):`${r}

${wt(l.map(n).join(`
`)).trim()}`}me(){console.log(mw.config.get("wgUserName")+"; "+(mw.config.get("wgUserId")||"未知UID")+"; "+(mw.config.get("wgUserGroups")||["未知用户组"]).join(", "))}async getMwApi(){await this.waitMwApi(),this.mwApi=new mw.Api,w("已获取mw.Api实例，可以开始工作...")}async waitMw(){let t=0;for(;!window.mw;)await B(500),O(t++<30,"未检测到 mw ！")}async waitMwApi(){await this.waitMw();let t=0;for(;!mw.Api;)await B(500),O(t++<30,"未检测到 mw ！")}async editHandler(t,e){if(!this.mwApi)return;let o=e,{before:n,after:r,handler:s,sum:l}=o,a=Rt(o,["before","after","handler","sum"]);return await this.mwApi.edit(t,function(c){let p=Object.assign({text:c.content,summary:l},a);if(n!=null&&r!=null)p.text=p.text.replace(n,r);else if(typeof s=="function"){let f=s(p.text,t);typeof f.text=="string"&&Object.assign(p,f)}return p})}async pageEdit(t){let{before:e,after:n,sum:r="",pageName:s}=t,l=s||mw.config.get("wgPageName");!this.pageNameCheck(l)||!this.mwApi||(await this.editHandler(l,{before:e,after:n,summary:r,minor:!0}),w("编辑已保存: "+l))}async pageHandle(t){let{handler:e,sum:n="",pageName:r}=t,s=r||mw.config.get("wgPageName");!this.pageNameCheck(s)||!this.mwApi||(await this.editHandler(s,{handler:e}),w("编辑已保存: "+s))}async wikiEdit(t){let{pages:e,before:n,after:r,sum:s="",timeInterval:l=200,sync:a=!1}=t,o=typeof e=="string"?e.split("; "):e;if(!(o.length<1)){w(`批量编辑 ${o.length} 个页面`);for(let c=0;c<o.length;c++){let p=o[c];if(!this.pageNameCheck(p))continue;let f=`${s||""} 第 ${c+1}/${o.length} 个`,u=async()=>{!this.mwApi||(await this.editHandler(p,{before:n,after:r,summary:f,minor:!0}),w(`第 ${c+1}/${o.length} 个编辑已保存: ${p}`))};if(a)try{await u()}catch(g){w(`第 ${c+1}/${o.length} 个页面“${p}”保存失败`)}else u();await B(l)}}}async wikiHandle(t){let{pages:e,handler:n,sum:r="",timeInterval:s=200,sync:l=!1}=t,a=typeof e=="string"?e.split("; "):e;w(`批量编辑 ${a.length} 个页面`);for(let o=0;o<a.length;o++){let c=a[o];if(!this.pageNameCheck(c))continue;let p=`${r||""} 第 ${o+1}/${a.length} 个`,f=async()=>{!this.mwApi||(await this.editHandler(c,{handler:n,summary:p}),w(`第 ${o+1}/${a.length} 个编辑已保存: ${c}`))};if(l)try{await f()}catch(u){w(`第 ${o+1}/${a.length} 个页面“${c}”保存失败`)}else f();await B(s)}}listEdit(t,e,n){this.wikiEdit({pages:this.titleList,before:t,after:e,timeInterval:n,sum:"列表替换：替换 “"+t+"” 为 “"+e+"”"})}async newSection(t,e){let n=mw.config.get("wgPageName");!this.pageNameCheck(n)||!this.mwApi||(await this.mwApi.newSection(n,t,e,{summary:`添加新章节“${t}”`,minor:!0}),w(`新章节“${t}”已保存到“${n}”`))}async newPage(t){let{content:e,pageName:n,sum:r}=t,s=n||mw.config.get("wgPageName");!this.pageNameCheck(s)||!this.mwApi||(await this.mwApi.create(s,{summary:r},e),w(`新页面“${s}”已保存`))}wikiSearch(t,e="0",n="max"){this.wikiSearchAndReplace({str:t,before:"",after:"",namespace:e,limit:n,srwhat:"text"})}wikiSearchTitle(t,e="0",n="max"){this.wikiSearchAndReplace({str:t,before:"",after:"",namespace:e,limit:n,srwhat:"title"})}wikiSearchAndReplace(t){let{str:e,before:n,after:r,namespace:s="0",limit:l="max",timeInterval:a=500,handle:o=!1,srwhat:c="text"}=t,p=this;if(!this.mwApi)return;let f=`${s instanceof Array?s.join("|"):s}`;w("搜索中..."),this.mwApi.get({action:"query",format:"json",list:"search",srsearch:e,srlimit:l+"",srnamespace:f,srwhat:c}).done(function(u){if(w("正在处理返回信息..."),typeof u.query!="undefined"&&typeof u.query.search!="undefined"){let g=u.query.search,y=[];for(let C of g)y.push(C.title);w(y),p.titleList=y.join("; "),o&&(w("成功获取信息，开始执行替换工作"),p.wikiEdit({pages:p.titleList,before:n,after:r,timeInterval:a,sum:"搜索替换：搜索“"+n+"” 替换为 “"+r+"”"}))}else w("没有成功获取到信息")})}pageNameCheck(t){return t?t.length<2?(w("页面名太短: "+t),!1):/^(特殊|special):/i.test(t)?(w("特殊页面不能编辑: "+t),!1):/^(媒体|media):/i.test(t)?(w("媒体页面不能编辑: "+t),!1):!0:!1}async addPlugin(){await this.waitMwApi();let t=new mw.Api;typeof t.postWithEditToken!="function"&&(w("mw.Api原型没有postWithEditToken方法，自动加载..."),mw.Api.prototype.postWithEditToken=function(e,n){return this.postWithToken("csrf",e,n)}),typeof t.getEditToken!="function"&&(w("mw.Api原型没有getEditToken方法，自动加载..."),mw.Api.prototype.getEditToken=function(){return this.getToken("csrf")}),typeof t.create!="function"&&(w("mw.Api原型没有create方法，自动加载..."),mw.Api.prototype.create=function(e,n,r){return this.postWithEditToken($.extend(this.assertCurrentUser({action:"edit",title:String(e),text:r,formatversion:"2",createonly:!0}),n)).then(function(s){return s.edit})}),typeof t.edit!="function"&&(w("mw.Api原型没有edit方法，自动加载..."),mw.Api.prototype.edit=function(e,n){var r,s,l=this;return e=String(e),l.get({action:"query",prop:"revisions",rvprop:["content","timestamp"],titles:[e],formatversion:"2",curtimestamp:!0}).then(function(a){var o,c;return!a.query||!a.query.pages?$.Deferred().reject("unknown"):(o=a.query.pages[0],!o||o.invalid?$.Deferred().reject("invalidtitle"):o.missing?$.Deferred().reject("nocreate-missing"):(c=o.revisions[0],r=c.timestamp,s=a.curtimestamp,n({timestamp:c.timestamp,content:c.content})))}).then(function(a){var o=typeof a=="object"?a:{text:String(a)};return l.postWithEditToken($.extend({action:"edit",title:e,formatversion:"2",assert:mw.config.get("wgUserName")?"user":void 0,basetimestamp:r,starttimestamp:s,nocreate:!0},o))}).then(function(a){return a.edit})}),typeof t.newSection!="function"&&(w("mw.Api原型没有newSection方法，自动加载..."),mw.Api.prototype.newSection=function(e,n,r,s){return this.postWithEditToken($.extend({action:"edit",section:"new",title:String(e),summary:n,text:r},s))})}};var{log:Wi}=h,V=class extends Q{constructor(t,e){super(t,e),Wi("构造完成...")}pageReplace(t=/$/,e="",n){this.pageEdit({before:t,after:e,sum:n||`替换 “${t}” 为 “${e}”`})}pageReplaceAll(t="",e){this.pageEdit({before:/[\S\s]*/g,after:t,sum:e||`整页替换为 “${t}”`})}pageAppend(t="",e){this.pageEdit({before:/$/,after:t,sum:e||`添加 “${t}” 到页尾`})}pagePrepend(t="",e){this.pageEdit({before:/^/,after:t,sum:e||`添加 “${t}” 到页首`})}pageScript(t,e){return this.pageHandle({handler:t,sum:e||"使用脚本处理页面"})}wikiReplace(t="",e=/$/,n="",r=500,s=!1){if(typeof t!="string"&&!Array.isArray(t))throw new Error("参数pages必须是以“; ”分割的字符串，或一个字符串数组");this.wikiEdit({pages:t,before:e,after:n,timeInterval:r,sum:`批量替换：替换 “${e}” 为 “${n}”`,sync:s})}wikiAppend(t="",e="",n=500,r=!1){if(typeof t!="string"&&!Array.isArray(t))throw new Error("参数pages必须是以“; ”分割的字符串，或一个字符串数组");this.wikiEdit({pages:t,before:/$/,after:e,timeInterval:n,sum:`批量添加：添加 “${e}” 到页尾`,sync:r})}wikiPrepend(t="",e="",n=500,r=!1){if(typeof t!="string"&&!Array.isArray(t))throw new Error("参数pages必须是以“; ”分割的字符串，或一个字符串数组");this.wikiEdit({pages:t,before:/^/,after:e,timeInterval:n,sum:`批量添加：添加 “${e}” 到页首`,sync:r})}wikiScript(t="",e,n=500,r=!1){if(typeof t!="string"&&!Array.isArray(t))throw new Error("参数pages必须是以“; ”分割的字符串，或一个字符串数组");this.wikiHandle({pages:t,handler:e,timeInterval:n,sum:"使用脚本批量处理页面",sync:r})}searchMain(t,e="max"){this.wikiSearch(t,"0",e)}searchUserpage(t,e="max"){this.wikiSearch(t,"2",e)}searchProject(t,e="max"){this.wikiSearch(t,"4",e)}searchFile(t,e="max"){this.wikiSearch(t,"6",e)}searchMediaWiki(t,e="max"){this.wikiSearch(t,"8",e)}searchTemplate(t,e="max"){this.wikiSearch(t,"10",e)}searchHelp(t,e="max"){this.wikiSearch(t,"12",e)}searchCategory(t,e="max"){this.wikiSearch(t,"14",e)}searchWidget(t,e="max"){this.wikiSearch(t,"274",e)}searchGadget(t,e="max"){this.wikiSearch(t,"2300",e)}searchMainTitle(t,e="max"){this.wikiSearchTitle(t,"0",e)}searchUserpageTitle(t,e="max"){this.wikiSearchTitle(t,"2",e)}searchProjectTitle(t,e="max"){this.wikiSearchTitle(t,"4",e)}searchFileTitle(t,e="max"){this.wikiSearchTitle(t,"6",e)}searchMediaWikiTitle(t,e="max"){this.wikiSearchTitle(t,"8",e)}searchTemplateTitle(t,e="max"){this.wikiSearchTitle(t,"10",e)}searchHelpTitle(t,e="max"){this.wikiSearchTitle(t,"12",e)}searchCategoryTitle(t,e="max"){this.wikiSearchTitle(t,"14",e)}searchWidgetTitle(t,e="max"){this.wikiSearchTitle(t,"274",e)}searchGadgetTitle(t,e="max"){this.wikiSearchTitle(t,"2300",e)}};var Hi={basic:`欢迎使用维基盐控制台脚本，本页面已经挂载了一个 we 对象，实例化自 SaltWikiEditHelper 类，使用 we.help() 来查看使用说明

如果您是前端开发者，也可以使用以下方式新建一个脚本实例
// const 新的控制台脚本 = new SaltWikiEditHelper()`,short:"we",methods:[{name:"wikiReplace",params:[{name:"pages",desc:"页面名集合。可以是一个数组；或是一个长字符串，用特殊标记（; ）（一个半角分号+一个空格）隔开，默认为空"},{name:"before",type:"字符串或者正则表达式",desc:"被替换的内容，可以用正则表达式，默认为添加到行尾"},{name:"after",desc:"要替换的内容，默认为空"},{name:"timeInterval",desc:"每次替换的时间间隔，单位毫秒，推荐 200-300，超过15个 500，超过35个 750，超过50个 1000，超过100个 1500，默认为 500"}]},{name:"wikiAppend",params:[{name:"pages",desc:"页面名集合。可以是一个数组；或是一个长字符串，用特殊标记（; ）（一个半角分号+一个空格）隔开，默认为空"},{name:"content",desc:"要添加到页尾的内容"},{name:"timeInterval",desc:"替换的时间间隔，单位毫秒，推荐值同上"}]},{name:"wikiPrepend",params:[{name:"pages",desc:"页面名集合。可以是一个数组；或是一个长字符串，用特殊标记（; ）（一个半角分号+一个空格）隔开，默认为空"},{name:"content",desc:"要添加到页首的内容"},{name:"timeInterval",desc:"替换的时间间隔，单位毫秒，推荐值同上"}]},{name:"wikiScript",params:[{name:"pages",desc:"页面名集合。可以是一个数组；或是一个长字符串，用特殊标记（; ）（一个半角分号+一个空格）隔开，默认为空"},{name:"handler",type:"(text: string, title: string) => { test: string, ... }",desc:"一个函数，用于处理页面代码",require:!0},{name:"timeInterval",desc:"每次替换的时间间隔，单位毫秒，推荐 200-300，超过15个 500，超过35个 750，超过50个 1000，超过100个 1500，默认为 500"}]},{name:"pageReplace",params:[{name:"before",type:"字符串或者正则表达式",desc:"被替换的内容，可以用正则表达式，默认为添加到行尾"},{name:"after",desc:"要替换的内容，默认为空"}]},{name:"pageReplaceAll",params:[{name:"content",desc:"将页面整个替换为这个内容"}]},{name:"pageAppend",params:[{name:"content",desc:"要添加到页尾的内容"}]},{name:"pagePrepend",params:[{name:"content",desc:"要添加到页首的内容"}]},{name:"pageScript",params:[{name:"handler",type:"(text: string, title: string) => { test: string, ... }",desc:"一个函数，用于处理页面代码",require:!0}]},{name:"searchMain",desc:"搜索主名字空间",params:[]},{name:"searchUserpage",desc:"搜索用户名字空间",params:[]},{name:"searchProject",desc:"搜索项目名字空间",params:[]},{name:"searchFile",desc:"搜索文件名字空间",params:[]},{name:"searchMediaWiki",desc:"搜索MediaWiki名字空间",params:[]},{name:"searchTemplate",desc:"搜索模板名字空间",params:[]},{name:"searchHelp",desc:"搜索帮助名字空间",params:[]},{name:"searchCategory",desc:"搜索分类名字空间",params:[]},{name:"searchWidget",desc:"搜索Widget名字空间",params:[]},{name:"searchGadget",desc:"搜索Gadget名字空间",params:[]},{name:"me",desc:"输出自己的用户名、UID、用户组",params:[]},{name:"help",desc:"详细教程",params:[]}]},Nt=Hi;function Ae(){window.we=new V("1.0.1",Nt),window.SaltWikiEditHelper=V,h.log("SaltWikiEditHelper子模块初始化完成"),h.log(`
`+Nt.basic)}var{log:Oi}=h;function Me(){Dt(()=>{Oi("正在初始化模块"),Te(),Se(),Ae()})}(async()=>(await qt(),Me()))();})();
/*!
Copyright (c) 2022 Salt-lovely
wiki-salt is licensed under Mulan PSL v2.
You can use this software according to the terms and conditions of the Mulan PSL v2.
You may obtain a copy of Mulan PSL v2 at:
        http://license.coscl.org.cn/MulanPSL2
THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT, MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
See the Mulan PSL v2 for more details.
*/
